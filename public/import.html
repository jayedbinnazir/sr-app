<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Retailer CSV Import</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px auto;
        max-width: 640px;
        line-height: 1.6;
        color: #1f2933;
      }
      h1 {
        margin-bottom: 0.5rem;
      }
      .card {
        border: 1px solid #d1d9e0;
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 10px 40px rgba(15, 36, 60, 0.08);
      }
      label {
        display: block;
        margin-top: 16px;
        font-weight: 600;
      }
      input[type='text'],
      input[type='file'] {
        width: 100%;
        padding: 10px;
        margin-top: 6px;
        border-radius: 4px;
        border: 1px solid #c5ced6;
      }
      button {
        margin-top: 20px;
        padding: 12px 18px;
        border: none;
        background: #2563eb;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
      }
      button:disabled {
        background: #9bb7f0;
        cursor: not-allowed;
      }
      .hint {
        font-size: 0.9rem;
        color: #52606d;
      }
      pre {
        background: #0e141b;
        color: #e5ecf5;
        padding: 16px;
        border-radius: 6px;
        overflow-x: auto;
      }
      #result {
        margin-top: 24px;
      }
    </style>
  </head>
  <body>
    <h1>Retailer CSV Import</h1>
    <p class="hint">
      Upload a retailers CSV file and optionally supply a bearer token. If
      you are logged in with your admin session in this browser, the request
      will also send cookies automatically.
    </p>
    <div class="card">
      <form id="uploadForm">
        <label for="file">CSV file</label>
        <input
          id="file"
          name="file"
          type="file"
          accept=".csv,text/csv"
          required
        />

        <label for="token">Bearer token (optional)</label>
        <input
          id="token"
          name="token"
          type="text"
          placeholder="Paste JWT here if you are not using cookies"
        />

        <button type="submit">Upload &amp; Enqueue</button>
      </form>
      <div id="result"></div>
    </div>

    <section>
      <h2>CSV format</h2>
      <p class="hint">
        Headers should match the columns below. Missing optional columns can
        be left empty.
      </p>
      <pre>
uid,name,phone,region_id,area_id,distributor_id,territory_id,points,routes,notes
RTL-0001,Elite Super Shop,+8801711000000,d2b4b327-56a9-4b34-8b73-8a6232af5dec,7f531df6-7899-4d9b-9a25-44d5aa5c9bda,, ,1200,"Route A","Best performer"
RTL-0002,City Mart,+8801712000000,d2b4b327-56a9-4b34-8b73-8a6232af5dec,7f531df6-7899-4d9b-9a25-44d5aa5c9bda,, ,950,"Route B",""
      </pre>
    </section>

    <script>
      const form = document.getElementById('uploadForm');
      const result = document.getElementById('result');

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        result.innerHTML = '';

        const fileInput = document.getElementById('file');
        if (!fileInput.files.length) {
          result.innerHTML = '<p>Please choose a CSV file first.</p>';
          return;
        }

        const token = document.getElementById('token').value.trim();
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);

        try {
          const response = await fetch(
            '/api/v1/admin/import/csv/retailers',
            {
              method: 'POST',
              headers: token
                ? { Authorization: `Bearer ${token}` }
                : undefined,
              body: formData,
              credentials: 'include',
            }
          );

          const payload = await response.json();
          const pretty = JSON.stringify(payload, null, 2);
          result.innerHTML = `
            <h3>Response (${response.status})</h3>
            <pre>${pretty}</pre>
          `;
        } catch (error) {
          result.innerHTML = `
            <h3>Upload failed</h3>
            <pre>${error?.message ?? error}</pre>
          `;
        }
      });
    </script>
  </body>
</html>


